<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UAF-Plankline: 1. Recommended Installs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UAF-Plankline
   &#160;<span id="projectnumber">v1.0</span>
   </div>
   <div id="projectbrief">THe UAF implementation of OSU&#39;s Plankline image processing system</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><ol type="1">
<li>Recommended Installs </li>
</ol>
</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>These are common utilities and/or prerequisites for one or more of the steps recommended by this setup document. </p><pre class="fragment">sudo apt-get install r-base net-tools ethtool libopencv-dev libgdal-dev timeshift htop openssh-server unzip git
</pre><p> <b>Python Related:</b> We are using python3 throughout the plankline processing scripts, and need to install some additional pacakges/libraries for image processing. </p><pre class="fragment">sudo apt-get install python3 python3-devpython3-pip python3-skimage python3-opencv
pip3 install gpustat
</pre><p> <b>NVIDIA Requirements for GPGPUs:</b> With these commands we first install the app key used to authenticate the nvidia package that we download using wget. The following commands then install the pacakge <em>cuda keyring</em>, which allows us to download and install nvidia drivers directly. Finally we install the development tools needed to compile CUDA applications ourselves. </p><pre class="fragment">sudo apt-key adv --fetch-keys https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/3bf863cc.pub &amp;&amp;
wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-keyring_1.0-1_all.deb

sudo dpkg -i cuda-keyring_1.0-1_all.deb
sudo apt-get update
sudo apt-get install libsparsehash-dev cuda-nvcc-11-8 libcublas-11-8 libcublas-dev-11-8
</pre><h2><a class="anchor" id="autotoc_md1"></a>
1.1 Compile and Install OpenCV 3.4</h2>
<p>Install the prerequisites </p><pre class="fragment">sudo apt-get install build-essential cmake libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev python3-dev python3-numpy libtbb2 libtbb-dev libsparsehash-dev
sudo apt-get install libjpeg-dev libpng-dev libtiff5-dev jasper libdc1394-dev libeigen3-dev libtheora-dev libvorbis-dev libxvidcore-dev libx264-dev sphinx-common libtbb-dev yasm libfaac-dev libopencore-amrnb-dev libopencore-amrwb-dev libopenexr-dev libgstreamer-plugins-base1.0-dev libavutil-dev libavfilter-dev libtesseract-dev libopenblas-dev libopenblas64-dev ccache
</pre><p>Get opencv2 and install it </p><pre class="fragment">cd /opt

git clone --branch 3.4 --single-branch https://github.com/opencv/opencv.git
git clone --branch 3.4 --single-branch https://github.com/opencv/opencv_contrib.git

cd opencv
mkdir release
cd release

cmake -D BUILD_TIFF=ON -D WITH_CUDA=ON -D WITH_OPENGL=OFF -D WITH_OPENCL=OFF -D WITH_IPP=OFF -D WITH_TBB=ON -D BUILD_TBB=ON -D WITH_EIGEN=OFF -D WITH_V4L=OFF -D WITH_VTK=OFF -D BUILD_TESTS=OFF -D BUILD_PERF_TESTS=OFF -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local -D OPENCV_EXTRA_MODULES_PATH=/opt/opencv_contrib/modules /opt/opencv/

make -j
sudo make install

sudo ldconfig
pkg-config --modversion opencv
</pre><h1><a class="anchor" id="autotoc_md2"></a>
2. NVIDIA CUDA</h1>
<pre class="fragment">sudo apt-get install nvidia-cuda-toolkit nvtop
</pre><p> <b>Nvidia Drivers for <b>Tesla</b> cards:</b> </p><pre class="fragment">sudo apt-get install libnvidia-compute-470 nvidia-utils-470 nvidia-driver-470-server
sudo ldconfig
</pre><p><b>Nvidia Drivers for <b>GTX</b> cards:</b></p>
<p><em>TODO: Add link to table of driver versions for each card.</em> </p><pre class="fragment">sudo apt-get install libnvidia-compute-515 nvidia-utils-515 nvidia-driver-515
sudo ldconfig
</pre><p>You can monitoring active NVIDIA processes with these commands </p><pre class="fragment">nvidia-smi
nvtop
</pre><h2><a class="anchor" id="autotoc_md3"></a>
Install RStudio Server</h2>
<p>Rstudio Server is a useful tool for running R processing scripts directly on the plankline computers using your local computer's browser. </p><pre class="fragment">sudo apt-get install gdebi-core;
wget https://download2.rstudio.org/server/jammy/amd64/rstudio-server-2022.07.1-554-amd64.deb;
sudo gdebi rstudio-server-2022.07.1-554-amd64.deb;
sudo nano /etc/rstudio/rserver.conf;
</pre><p> Add "www-port=80", then restart the service: </p><pre class="fragment">sudo systemctrl restart rstudio-server
</pre><p> The Rstudio Server should now be available at <a href="http://">http://</a>&lt;computer name&gt;/. For example, <a href="http://plankline-2/">http://plankline-2/</a>. Please see the section below about setting the computer name is it has not already been set.</p>
<p><b>To install the plankline processing scripts:</b> Note, that the default "home" directory for rstudio will be the home directory of the user that you are log in as. </p><pre class="fragment">cd ~
git clone https://github.com/tbrycekelly/Plankline-Processing-Scripts.git
</pre><p> From an Rstudio Server instance (i.e. in the browser), open the Plnkline-Processing-Scripts project, and nvigate to the Workflows subdirectory. This is the folder that contains all the basic workflow scripts for processing and analyzing the plankline image and sensor data. Run the <em>one time setup</em> script to install and verify functionality. This only needs to be done once per install, but it is an easy cehck that everything is working as it should.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Install Netdata</h2>
<p>Netdata is a useful system monitor that is accessible over the network (e.g. <a href="http://">http://</a>&lt;computer name&gt;:19999/). It gives detailed statistics about a wide variety of computer resources (except for the GPUs). </p><pre class="fragment">wget -O /tmp/netdata-kickstart.sh https://my-netdata.io/kickstart.sh &amp;&amp; sh /tmp/netdata-kickstart.sh
</pre><p> Point a broswer at <a href="http://">http://</a>&lt;computer name&gt;:19999/ to verify install.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Linux Reference Guide</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
1. Introduction to working with Linux</h2>
<h2><a class="anchor" id="autotoc_md7"></a>
2. Common commands and activities</h2>
<p><b>Set password:</b> </p><pre class="fragment">sudo passwd plankline
</pre><p> <b>Set hostname:</b> This is how you set the computer name. Our current convention is to use lowercase plankline followed by a number: e.g. <b>plankline-7</b> </p><pre class="fragment">hostnamectl set-hostname plankline-1
</pre><p> <b>Add users:</b> </p><pre class="fragment">sudo adduser XXXX
sudo usermod -aG sudo XXXXX
sudo usermod -aG plankline XXXXX
</pre> <h2><a class="anchor" id="autotoc_md8"></a>
3. Misc Setup</h2>
<p><b>Setup a scratch filesystem:</b> To setup a very fast scratch drive, add the following mount configuration to <code>/etc/fstab</code> </p><pre class="fragment">tmpfs /tmp tmpfs defaults,noatime,nosuid,nodev,mode=777,size=60G 0 0
</pre><p><b>Setup Automounting:</b> On Ubuntu, automounting is configured by the fstab file and is automatically run during system startup. </p><pre class="fragment">lsblk
sudo nano /etc/fstab
</pre><p> "/dev/sdX   /media/plankline/Data   ext4    defaults,rw,user    0   0" </p><pre class="fragment">mkdir -p /media/plankline/data
sudo chmod -R 777 /media/plankline
sudo mount -a
</pre><p><b>Set swapiness:</b> This is a minor performance tweak to diswade the computer from ever trying to use hard drive swap space over system memory. These computer generally have plenty of memory and have no need for offloading to physical media. </p><pre class="fragment">sudo nano /etc/sysctl.conf
</pre><p> add "vm.swappiness=1" to the file.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
4. Setup Backups</h2>
<p>Timeshift is a useful tool for maintaining backups of linux directories. Only needs to be done once per computer. </p><pre class="fragment">sudo apt-get install timeshift
sudo timeshift --create
</pre><p> Using NoMachine (or local monitor), open timshift and setup automatic scheduled backups. I'd recommend keeping 5 daily, 4 weekly, and 12 monthly backups. Or, using the terminal: </p><pre class="fragment">sudo nano /etc/timeshift/timeshift.json
</pre><h2><a class="anchor" id="autotoc_md10"></a>
5. Networking</h2>
<p><b>Setup Firewall:</b> To check the status of the firewall: </p><pre class="fragment">sudo ufw status
</pre><p> To allow connections on particular ports (e.g. 80 for <em>Shiny</em> and 19999 for <em>netdata</em>): </p><pre class="fragment">sudo ufw allow 8000:8100/tcp
sudo ufw allow 19999    
sudo ufw allow 9993
sudo ufw allow http
sudo ufw limit ssh
sudo ufw allow "CUPS"
sudo ufw allow "Samba"
sudo ufw allow 4000/tcp
sudo ufw allow 4080
sudo ufw allow 4443
sudo ufw allow 4011:4999/udp
</pre><p> To turn off the firewall: </p><pre class="fragment">sudo ufw disable
</pre><p> To View Rules and Delete them: </p><pre class="fragment">sudo ufw status numbered
sudo ufw delete XX
</pre><p> <b>Install intel 10G driver:</b> Download from Intel X520 IXGBE driver from a trusted source. <em>TODO: include a copy of the driver on a shared networked location.</em> </p><pre class="fragment">tar xzf ./ixgbe-5.16.5.tar.gz
cd ./ixgbe-5.16.5/src/
sudo make install
sudo nano /etc/default/grub
</pre><p> Add "ixgbe.allow_unsupported_sfp=1" to GRUB_CMDLINE_LINUX="" line </p><pre class="fragment">sudo grub-mkconfig -o /boot/grub/grub.cfg
sudo rmmod ixgbe &amp;&amp; sudo modprobe ixgbe allow_unsupported_dfp=1
sudo update-initramfs -u
</pre><p> Check to see if network interface is present, e.g. eno1 </p><pre class="fragment">ip a
</pre><p> Additional network inspection can be performed by ethtool: </p><pre class="fragment">ethtool &lt;interface&gt;
ethtool eno1
</pre><p><b>Setup NFS:</b> (Linux and Windows networking shares) <em>work in progress</em></p>
<p>_On a windows computer, you need to install the NFS support as an optional windows add-on. In the start menu &gt; Turn Windows Features On and Off &gt; NFS Support. Install NFS client. _ </p><pre class="fragment">sudo apt install nfs-kernel-server
sudo systemctl start nfs-kernel-server.service

nano /etc/exports
</pre><p> Add the following lines: </p><pre class="fragment">/media/plankline/ingest    *(rw,sync,subtree_check)
</pre><p> <b>Setup Samba:</b> (Windows SMB) </p><pre class="fragment">sudo apt-get install samba samba-client
sudo nano /etc/samba/smb.conf
</pre><p>Inside the smb.conf file, go to the bottom of the file and add the following (or something similar). This will setup a share named <em>ingest</em> which will be writable by everyone (no security) on the network. </p><pre class="fragment">[ingest]
    comment = Plankline data drive.
    path = /media/plankline/ingest
    browsable = yes
    guest ok = yes
    read only = no
    create mask = 0777
</pre><p> Can do the same for an output directory share. </p><pre class="fragment">[output]
    comment = Plankline output drive.
    path = /media/plankline/data
    browsable = yes
    guest ok = yes
    read only = no
    create mask = 0777
</pre><p>Create the directory given above: </p><pre class="fragment">sudo mkdir -p /media/plankline/ingest
sudo chown nobody:nogroup /media/plankline/ingest
</pre><p> Restart samba to apply the edits. </p><pre class="fragment">sudo systemctl restart smbd.service
</pre><p> The folder /media/plankline/ingest should now be available as \plankline-X\ingest from any file manager or as <a href="http://plankline-x/ingest">http://plankline-x/ingest</a> from the browser.</p>
<p><b>FTP:</b></p>
<p><b>Mount NAS on Plankline:</b> </p><pre class="fragment">sudo apt-get install cifs-utils
sudo mkdir /mnt/shuttle
sudo chmod 777 /mnt/shuttle
sudo chown nobody:nogroup /mnt/shuttle
sudo mount -t cifs -o user=tbkelly //10.25.187.104/shuttle /mnt/shuttle
sudo nano /etc/fstab
</pre><p> Add line: "//10.25.187.104/shuttle  /mnt/shuttle    cifs    user=&lt;user&gt;,pass=&lt;password&gt; 0   0"</p>
<h2><a class="anchor" id="autotoc_md11"></a>
6. Misc Linux Tasks</h2>
<p><b>Install NoMachine:</b></p>
<p><a href="https://www.nomachine.com/download">https://www.nomachine.com/download</a></p>
<p><b>RAID-based data drive:</b></p>
<p>After setting up the disk stucture in the BIOS, open <em>disks</em> to create a new partition on the array. Choose XFS file system (or EXT4).</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Performance Testing</h1>
<h2><a class="anchor" id="autotoc_md13"></a>
Disk speed</h2>
<p>To test disk IO, here's a one liner that will write a file of all zero's to a target location. </p><pre class="fragment">dd if=/dev/zero of=&lt;testing dir&gt;/tmp.data bs=10G count=1 oflag=dsync
</pre><p> Example Results for <em>Plankline-2</em>: </p><pre class="fragment">plankline-2:/media/plankline/Data/Data      654 MB/s
plankline-2:/tmp                            1100 MB/s
plankline-2:/home/tbkelly                   928 MB/s
</pre><p> <b>Recommended test set:</b> </p><pre class="fragment">dd if=/dev/zero of=/media/plankline/Data/Data/tmp.data bs=10G count=1 oflag=dsync
dd if=/dev/zero of=/tmp/tmp.data bs=10G count=1 oflag=dsync
dd if=/dev/zero of=/home/tbkelly/tmp.data bs=10G count=1 oflag=dsync
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
