<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UAF-Plankline: Documentation for UAF-Plankline</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UAF-Plankline
   &#160;<span id="projectnumber">v1.0</span>
   </div>
   <div id="projectbrief">THe UAF implementation of OSU&#39;s Plankline image processing system</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Documentation for UAF-Plankline </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>N.B. This version of plankline was forked and adapted significantly from the <a href="https://zenodo.org/record/4641158">original OSU version</a>(DOI: 10.5281/zenodo.4641158)<a href="#1">[1]</a>. The following is a high-level summary of the changes applied in no particular order.</p>
<ol type="1">
<li>The segmentation and SCNN executables have been relocated to /opt/Threshold-MSER and /opt/SCNN, respectively. This allows all users to use these utilities without having to change/fix the paths.</li>
<li>All settings for segmentation and classification are now set within the .ini file itself. This is the only file that should be modified between projects/runs/etc. I am still working on the inline documentation in the config file. Eventually will make a "default.ini" to make copies of.</li>
<li>A new set of logging utilities are built in to allow for detailed and configurable logging routines to be used. All log entries are timestamped and given a status level: INFO, DEBUG, WARN, ERROR, CRITICAL. Default log files are places into the working directory (e.g. /media/plankline/Data/Data/projectX/) and timestamped. Logs for the executables are located in their respective folders.</li>
<li>Only some messages are printed to the screen by default (except warnings and errors), including only key information. A progress bar is shown for the majority of the processing.</li>
<li>Both scripts are now run by calling the python file directly.</li>
<li>Currently I have not implemented/adapted the previous directory/file verification functions that plankline used. So both scripts will rewrite all existing files and does not check/verify if output exists.</li>
</ol>
<hr  />
<h1><a class="anchor" id="autotoc_md27"></a>
Installation</h1>
<p>Please see /home/thomas/Github/UAF-Plankline/Notes/Plankline Setup.md "Plankline Setup" for installation instructions.</p>
<h1><a class="anchor" id="autotoc_md28"></a>
Segmentation (MSER)</h1>
<p>The segmentation algorithm used in the <em>Plankline</em> processing suite is nomally a <b>Maximally Stable Extremal Region</b> approach as implemented in <em>opencv</em>, but there are caveats. Depending onthe signal to noise ratio hyperparamter (<b>SNR</b>), one of three possible segmentation routines are called. SNR is calculated as follows (imageProcessing.cpp:497). </p><pre class="fragment">float SNR(const cv::Mat&amp; img) {
    // perform histogram equalization
    cv::Mat imgHeq;
    cv::equalizeHist(img, imgHeq);

    // Calculate Signal To Noise Ratio (SNR)
    cv::Mat imgClean, imgNoise;
    cv::medianBlur(imgHeq, imgClean, 3);
    imgNoise = imgHeq - imgClean;
    double SNR = 20*( cv::log(cv::norm(imgClean,cv::NORM_L2) / cv::norm(imgNoise,cv::NORM_L2)) );

    return SNR;
</pre><p> When the SNR of an image is greater than that provided, then the MSER algorithm is called immediately after flatfielding and preprocessing (with a <code>3x3</code> kernel) <a href="#2">[2]</a>. If the SNR is greater than 75% of the hyperparamter value, then the image is flatfielded, proprocessed (with a <code>17x17</code> kernel), and then thresholded based on the <b>threshold</b> hyperparameter. A contouring algorithm is then applied to find specific ROIs. Finally, if the image SNR is below 75% of the hyperparamter value, then the image is flatfielded, proprocessed using the same <code>17x17</code> kernel and otherwise processed identically to the previous processing (but in a standalone function).</p>
<h1><a class="anchor" id="autotoc_md29"></a>
Training</h1>
<h1><a class="anchor" id="autotoc_md30"></a>
Classification</h1>
<h2><a class="anchor" id="autotoc_md31"></a>
References</h2>
<p><a class="anchor" id="1"></a>[1] Schmid, Moritz S, Daprano, Dominic, Jacobson, Kyler M, Sullivan, Christopher, Brise√±o-Avena, Christian, Luo, Jessica Y, &amp; Cowen, Robert K. (2021). A Convolutional Neural Network based high-throughput image classification pipeline - code and documentation to process plankton underwater imagery using local HPC infrastructure and NSF's XSEDE (1.0.0). Zenodo. <a href="https://doi.org/10.5281/zenodo.4641158">https://doi.org/10.5281/zenodo.4641158</a></p>
<p><a class="anchor" id="2"></a>[2] Preprocessing here entails an erosion and dialation step conducted by <em>opencv</em>. The erosion kernel size is <code>2*size+1</code> and thus is a <code>3x3</code> or <code>17x17</code> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
